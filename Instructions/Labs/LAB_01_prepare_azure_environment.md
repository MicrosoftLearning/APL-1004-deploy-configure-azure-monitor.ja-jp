---
lab:
  title: Azure 環境を準備する
  module: Guided Project - Deploy and configure Azure Monitor
---

## サブスクリプション持ち込み (BYOS) を準備する

この一連のラボ演習では、Azure サブスクリプションに対するグローバル管理者のアクセス許可があることを前提としています。

1. Azure portal の上部にある検索バーで「**リソース グループ**」と入力し、検索結果から **[リソース グループ]** を選択します。
1. **[リソース グループ]** ページで、**[作成]** を選択します。
1. **[リソース グループの作成]** ページで、[サブスクリプション] を選択し、「rg-alpha」という名前を入力します。 リージョンを「米国東部」に設定し、**[確認と作成]** を選択して、**[作成]** を選択します。

> [!NOTE]
> この一連の演習では、米国東部リージョンにデプロイを選択することを前提としていますが、選択すれば別のリージョンに変更できます。 これらの手順で米国東部がメンションがされるたびに、選択したリージョンを置き換える必要があることを覚えておいてください。

## アプリ ログ調査官 セキュリティ グループを作成する

この演習では、Entra ID セキュリティ グループを作成します。

1. Azure portal の検索バーで、結果の一覧から Azure Active Directory (または Entra ID) と Azure Active Directory (または Entra ID) を入力します。
1. **[既定のディレクトリ]** ページで、**[グループ]** を選びます。
1. **[グループ]** ページで、**[新しいグループ]** を選択します。
1. **[新しいグループ]** ページで、次のテーブルの値を指定し、**[作成]** を選択します。


    | プロパティ | 値    |
    |:---------|:---------|
    | グループの種類  | セキュリティ   |
    | グループ名  | AppLogExaminers   |
    | グループの説明  | AppLogExaminers   |


## WS-VM1 のデプロイと設定

この演習では、Windows Server 仮想マシンをデプロイして構成します。

1. Azure portal の検索バーで「**Virtual Machines**」と入力し、結果のリストから **[Virtual Machines]** を選択します。
1. **[Virtual Machines]** ページで、**[作成]** を選択し、**[Azure 仮想マシン]** を選択します。
1. 仮想マシンの作成ウィザードの **[基本]** ページで、次の設定を選択し、**[確認と作成]** を選択します。

    | プロパティ | 値    |
    |:---------|:---------|
    | サブスクリプション  | 該当するサブスクリプション   |
    | リソース グループ    | rg-alpha  |
    | 仮想マシン名  | WS-VM1   |
    | リージョン    | 米国東部  |
    | 可用性オプション  | インフラストラクチャの冗長性は必要ありません  |
    | セキュリティの種類 | Standard   |
    | イメージ | Windows Server 2022 データセンター: Azure Edition - x64 Gen2  |
    | VMアーキテクチャ   | X64  |
    | 規模  | Standard_D4s_v3 - 4 vcpus、16 GiB メモリ  |
    | 管理者アカウント | 素数  |
    | Password  | [一意のセキュリティで保護されたパスワードを選択する] P@ssw0rdP@ssw0rd   |
    | 受信ポート | RDP 3389   |

4. 設定を確認し、 **[作成]** を選択します。
1. デプロイが完了するまで待ちます。 デプロイが完了したら、**[リソースに移動]** を選択します。
1. **[WS-VM1 のプロパティ]** ページで、**[ネットワーク]** を選択します。
1. **[ネットワーク]** ページで、[RDP ルール] を選択します。 
1. RDP ルール スペースで、[ソース] を [My IP アドレス] に変更し、**[保存]** を選択します。　

    これにより、受信 RDP 接続が現在使用している IP アドレスに制限されます。

9. **[ネットワーク]** ページで、**[受信ポート規則の追加]** を選択します。
1. **[受信セキュリティ規則の追加]** ページで、次の設定を構成し、**[追加]** を選択します。

    | プロパティ | 値    |
    |:---------|:---------|
    | source  | [任意]  |
    | ソース ポート範囲    | *   |
    | 宛先  | [任意]   |
    | アクション    | Allow  |
    | Priority  | 310   |
    | 名前  | AllowAnyHTTPInbound  |

11. **[WS-VM1]** ページで、**[接続]** を選択します。
1. [ネイティブ RDP] で、**[選択]** を選択します。
1. **[ネイティブ RDP]** ページで、**[RDP ファイルのダウンロード]** を選択し、ファイルを開きます。 RDP ファイルを開くと、[リモート デスクトップ接続] ダイアログ ボックスが開きます。
1. **[Windows セキュリティ]** ダイアログ ボックスで、**[その他の選択肢]** を選択し、[別のアカウントを使用する] を選択します。
1. ユーザー名は「.\prime」、パスワードはステップ 3 で選択したセキュリティで保護されたパスワードを入力し、**[OK]** を選択します。
1. Windows Server 仮想マシンにサインインしたら、**[スタート]** ヒントを右クリックし、**[Windows PowerShell] (管理者)** を選択します。
1. 管理者特権でのコマンド プロンプトで次のコマンドを入力し、**[入力]** を押します。
    Install-WindowsFeature Web-Server -IncludeAllSubFeature -IncludeManagementTools 
1. インストールが完了したら、次のコマンドを実行して Web サーバーのルート ディレクトリに変更します。
    Cd c:\inetpub\wwwroot\
1. 次のコマンドを実行します。
    Wget https://raw.githubusercontent.com/Azure-Samples/html-docs-hello-world/master/index.html-OutFile index.html


## LX-VM2 のデプロイと構成

この演習では、Linux 仮想マシンをデプロイして構成します。

1. Azure portal の検索バーで「**Virtual Machines**」と入力し、結果のリストから **[Virtual Machines]** を選択します。
1. **[Virtual Machines]** ページで、**[作成]** を選択し、**[Azure 仮想マシン]** を選択します。
1. 仮想マシンの作成ウィザードの **[基本]** ページで、次の設定を選択し、**[確認と作成]** を選択します。

    | プロパティ | 値    |
    |:---------|:---------|
    | サブスクリプション  | 該当するサブスクリプション   |
    | リソース グループ    | rg-alpha  |
    | 仮想マシン名  | Linux-VM2   |
    | リージョン    | 米国東部  |
    | 可用性オプション  | インフラストラクチャの冗長性は必要ありません  |
    | セキュリティの種類 | Standard   |
    | イメージ | Ubuntu Server 20.04 LTs – x64 Gen2  |
    | VMアーキテクチャ   | X64  |
    | 規模  | Standard_D2s_v3 – 2 vcpus、8 GiB メモリ  |
    | 認証の種類   | パスワード  |
    | ユーザー名  | Prime   |
    | Password  | [一意のセキュリティで保護されたパスワードを選択する] P@ssw0rdP@ssw0rd   |
    | パブリック受信ポート  | なし   |

4. 情報を確認し、**[作成]** を選択します。
1. VM がデプロイされたら、**[VM プロパティ]** ページを開き、**[設定]** で **[拡張機能 + アプリケーション]** を選択します。
1. **[追加]** を選択し、**[Linux 用 Network Watcher Agent]** を選択します。 **[次へ]** を選択し、**[確認と作成]** を選択します。 **[作成]** を選択します。
1. AzureNetworkWatcherExtension と OmsAgentForLinux 拡張機能を自動的にアップグレードするように構成します。


## SQL Database を使用して Web アプリをデプロイする

1. Azure portal にサインインしていることを確認します。
1. ブラウザーで新しいタブを開き、https://github.com/Azure/azure-quickstart-templates/tree/master/quickstarts/microsoft.web/web-app-sql-database に移動します。
1. GitHub ページで、**[Azure へのデプロイ]** を選択します。
1. 新しいタブが開きます。 必要に応じて、グローバル管理i者権限を持つアカウントで Azure に再サインインします。
1. **[基本]** ページで、**[テンプレートの編集]** を選択します。
1. テンプレート エディターで、158 行目から 174 行目までの内容を削除し、157 行目の「,」を削除します。 **保存**を選択します。
1. **[基本]** ページで、次の情報を入力してから、**[次へ]** を選択します。

    | プロパティ | 値    |
    |:---------|:---------|
    | サブスクリプション  | 該当するサブスクリプション   |
    | リソース グループ    | rg-alpha  |
    | リージョン    | 米国東部  |
    | SKU の名前  | F1  |
    | SKU 容量  | 1   |
    | SQL 管理者ログイン   | 素数  |
    | Sql 管理者ログイン パスワード  | [一意のセキュリティで保護されたパスワードを選択する] P@ssw0rdP@ssw0rd   |

8. 表示された情報を確認し、**[作成]** を選択します。
1. デプロイが完了したら、**[リソース グループに移動する]** を選択します。

## Linux Web アプリのデプロイ

1. Azure portal にサインインしていることを確認します。
1. ブラウザーで新しいタブを開き、https://learn.microsoft.com/en-us/samples/azure/azure-quickstart-templates/webapp-basic-linux/ に移動します。
1. GitHub ページで、**[Azure へのデプロイ]** を選択します。
1. **[基本]** ページで、次の情報を入力してから、**[次へ]** を選択します。

    | プロパティ | 値    |
    |:---------|:---------|
    | サブスクリプション  | 該当するサブスクリプション   |
    | リソース グループ    | rg-alpha  |
    | リージョン    | 米国東部  |
    | Web アプリの名前  | AzureLinuxAppWXYZ (名前の最後の 4 文字に乱数を割り当てる)  |
    | SKU   | S1   |
    | Linux Fx バージョン  | php|7.4  |

5. 情報を確認し、**[作成]** を選択します。
